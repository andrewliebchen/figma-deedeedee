<style>
  button {
    width: 100%;
    display: block;
  }

  textarea {
    width: 100%;
    display: block;
    margin: 0.5em 0;
  }
</style>


<textarea id="figma_output"></textarea>
<button id="download_figma">Download figma.js</button>
<button id="copy_figma">Copy</button>
<hr />

<textarea id="manifest_output"></textarea>
<button id="download_manifest">Download manifest.js</button>
<button id="copy_manifest">Copy</button>

<script>
  function downloadFile(text, filename) {
    let file = new Blob([text], {type: "text/plain"})
    let a = document.createElement("a");
    let url = URL.createObjectURL(file);

    a.href = url;
    a.download = filename;
    document.body.appendChild(a);
    a.click();

    setTimeout(function() {
      document.body.removeChild(a);
      window.URL.revokeObjectURL(url);
    }, 0);
  }

  function copy(targetId) {
    document.getElementById(targetId).select();
    document.execCommand("copy");
  }


  window.onmessage = async event => {
    if (!event.data.pluginMessage) return;
    const { exportableBytes, manifest } = event.data.pluginMessage;

    const figmaText = `export default = ${JSON.stringify(exportableBytes)}`;
    const manifestText = `export default = ${JSON.stringify(manifest)}`;


    // Download buttons
    document.getElementById("download_figma").addEventListener(
      "click", function() {
        downloadFile(figmaText, "figma.js");
      }
    );

    document.getElementById("download_manifest").addEventListener(
      "click", function() {
        downloadFile(manifestText, "manifest.js");
      }
    );

    // Copy buttons
    document.getElementById(
      "figma_output"
    ).value = figmaText;
    document.getElementById("copy_figma")
      .addEventListener("click", function() {
        document.getElementById("figma_output").select();
        document.execCommand("copy");
      });

    document.getElementById(
      "manifest_output").value = manifestText;
    document.getElementById("copy_manifest")
      .addEventListener("click", function() {
        document.getElementById("manifest_output").select();
        document.execCommand("copy");
      });
  };
</script>
